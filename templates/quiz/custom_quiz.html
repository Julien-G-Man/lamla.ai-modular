{% extends "base.html" %}
{% load static %}

{% block extra_head %}
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Page stylesheet -->
    <link rel="stylesheet" href="{% static 'css/custom_quiz.css' %}">
{% endblock %}

{% block content %}
<div class="page-wrapper">
    <div class="quiz-card-container" role="main">
        <h1 class="main-page-title">ðŸ§  Quiz Mode</h1>
        <p class="main-page-description">
            Upload your study materials or paste content to create customized quiz questions with AI.
        </p>

        <form id="quizForm" method="post" enctype="multipart/form-data" action="{% url 'generate_questions' %}">
            {% csrf_token %}

            <!-- Subject selection: select + optional custom input -->
            <div class="subject-section">
                <label for="subjectSelect" class="subject-label">
                    <span>ðŸ“š</span> Subject / Topic
                </label>

                <!-- Select kept as subject_select to avoid accidental duplicate 'subject' fields;
                     a hidden input named "subject" will hold the actual value submitted. -->
                <select name="subject_select" id="subjectSelect" class="subject-select" aria-describedby="subjectHint">
                    <option value="" disabled selected>Select a subject or topic</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="Computer Science">Computer Science</option>
                    <option value="Engineering">Engineering</option>
                    <option value="Biology">Biology</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Physics">Physics</option>
                    <option value="English">English</option>
                    <option value="History">History</option>
                    <option value="Geography">Geography</option>
                    <option value="Economics">Economics</option>
                    <option value="Other">Other (type your own)</option>
                </select>

                <!-- Visible only when user selects "Other" -->
                <div id="customSubjectContainer" class="custom-subject-container" style="display: none; margin-top:12px;">
                    <input type="text" id="customSubjectInput" class="subject-input" placeholder="Type subject/topic (e.g. 'Quantum Mechanics')" aria-label="Custom subject">
                </div>

                <!-- Hidden input that will carry the actual subject value to server -->
                <input type="hidden" name="subject" id="subjectHidden" value="">

                <div id="subjectHint" class="subject-hint">
                    <i class="fas fa-info-circle"></i>
                    Select your subject or enter a custom one when selecting "Other".
                </div>
            </div>

            <!-- Tabs -->
            <div class="tab-group" role="tablist" aria-label="Content input mode">
                <button type="button" role="tab" aria-selected="true" class="tab active" id="textTab">
                    <i class="fas fa-keyboard" aria-hidden="true"></i> Enter Text
                </button>
                <button type="button" role="tab" aria-selected="false" class="tab" id="fileTab">
                    <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i> Upload File
                </button>
            </div>

            <!-- Text content -->
            <div class="tab-content" id="textContent" role="tabpanel" aria-labelledby="textTab">
                <textarea name="extractedText" id="studyText" placeholder="Paste your study materials here..." aria-label="Paste study materials"></textarea>
            </div>

            <!-- File content -->
            <div class="tab-content" id="fileContent" role="tabpanel" aria-labelledby="fileTab" style="display:none;">
                <div class="upload-zone">
                    <div class="upload-icon" aria-hidden="true">ðŸ“–</div>
                    <div class="upload-text">Upload your study materials</div>
                    <div class="upload-description">Upload PDF, DOCX, PPT, PPTX, or text files to analyze</div>

                    <input type="file" name="slide_file" id="slideFile"
                           accept=".pdf,.docx,.ppt,.pptx,.txt"
                           class="hidden-file-input" aria-label="Upload file">

                    <label for="slideFile" class="select-file-button" id="selectFileButton" role="button">Select file</label>
                    <span id="fileNameDisplay" class="file-name-display" aria-live="polite"></span>
                </div>
            </div>

            <!-- Options -->
            <div class="options-row" role="group" aria-label="Quiz options">
                <div class="option-group">
                    <span><i class="fas fa-list-ul"></i> MCQ Questions</span>
                    <input type="number" name="num_mcq" id="numMcqInput" value="5" min="0" max="50" class="number-input" aria-label="Number of MCQs">
                </div>

                <div class="option-group">
                    <span><i class="fas fa-pen"></i> Short Answer</span>
                    <input type="number" name="num_short" id="numShortInput" value="3" min="0" max="20" class="number-input" aria-label="Number of short answer questions">
                </div>

                <div class="option-group">
                    <span><i class="fas fa-clock"></i> Quiz Time (minutes)</span>
                    <input type="number" name="quiz_time" id="quizTimeInput" value="10" min="1" max="120" class="number-input" aria-label="Quiz time in minutes">
                </div>

                <div class="option-group">
                    <span><i class="fas fa-chart-line"></i> Difficulty</span>
                    <select name="difficulty" id="difficultySelect">
                        <option value="random" selected>Random</option>
                        <option value="easy">Easy</option>
                        <option value="medium">Medium</option>
                        <option value="hard">Hard</option>
                    </select>
                </div>
            </div>

            <!-- Actions -->
            <div class="actions-row">
                <button type="submit" class="main-btn">Generate Questions</button>
                <button type="button" class="clear-btn" id="clearBtn">Clear</button>
            </div>
        </form>

        <!-- Extract spinner -->
        <div class="extract-spinner" id="extractSpinner" style="display:none;">
            <div class="spinner" aria-hidden="true"></div>
            Extracting text...
        </div>

        <!-- Error message -->
        {% if error_message %}
            <div class="api-error-message" role="alert">{{ error_message }}</div>
        {% endif %}

        <!-- Results -->
        {% if quiz_results %}
            <div class="quiz-results-container" aria-live="polite">
                <h3 class="results-title">Generated Questions</h3>

                {% if quiz_results.mcq_questions %}
                    <h4 class="question-type-title">
                        <i class="fas fa-list-ul"></i> Multiple Choice Questions
                    </h4>
                    <ol class="question-list">
                        {% for q in quiz_results.mcq_questions %}
                            <li class="question-item">
                                <div class="question-text"><b>{{ q.question }}</b></div>
                                <ul class="options-list">
                                    {% for opt in q.options %}
                                        <li>{{ opt }}</li>
                                    {% endfor %}
                                </ul>
                                <div class="question-answer">Answer: <b>{{ q.answer }}</b></div>
                            </li>
                        {% endfor %}
                    </ol>
                {% endif %}

                {% if quiz_results.short_questions %}
                    <h4 class="question-type-title">
                        <i class="fas fa-pen"></i> Short Answer Questions
                    </h4>
                    <ol class="question-list">
                        {% for q in quiz_results.short_questions %}
                            <li class="question-item">
                                <div class="question-text"><b>{{ q.question }}</b></div>
                                <div class="question-answer">Answer: <b>{{ q.answer }}</b></div>
                            </li>
                        {% endfor %}
                    </ol>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<div class="toast" id="toast" role="status" aria-live="polite"></div>
{% endblock %}

{% block extra_body %}
    <script src="{% static 'js/custom_quiz.js' %}"></script>
{% endblock %}
